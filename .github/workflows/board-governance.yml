# .github/workflows/board-governance.yml

name: Generate TSC Board Members JSON

on:
  push:
    paths:
      - 'config/MAINTAINERS.json'
      - 'config/AMBASSADORS_MEMBERS.json'
  workflow_dispatch:

jobs:
  generate-json:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - run: npm install
      - run: npm run generate:board

      - name: Create Pull Request with re-generated TSC_BOARD_MEMBERS.json
        uses: peter-evans/create-pull-request@38e0b6e68b4c852a5500a94740f0e535e0d7ba54 # use 4.2.4 https://github.com/peter-evans/create-pull-request/releases/tag/v4.2.4
        with:
            token: ${{ secrets.GH_TOKEN }}
            commit-message: 'chore: update TSC_BOARD_MEMBERS.json'
            committer: asyncapi-bot <info@asyncapi.io>
            author: asyncapi-bot <info@asyncapi.io>
            title: 'chore: update TSC_BOARD_MEMBERS.json'
            branch: update-tsc-board-/${{ github.job }}

      - if: failure() # Only, on failure, send a message on the 94_bot-failing-ci slack channel
        name: Report workflow run status to Slack
        uses: 8398a7/action-slack@fbd6aa58ba854a740e11a35d0df80cb5d12101d8 #using https://github.com/8398a7/action-slack/releases/tag/v3.15.1
        with:
          status: ${{ job.status }}
          fields: repo,action,workflow
          text: 'AsyncAPI TSC board members workflow failed'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_CI_FAIL_NOTIFY }}
